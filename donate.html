<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>영상 도네이션</title>
<style>
body{font-family:sans-serif;background:#0f172a;color:#e6edf3;display:flex;justify-content:center;padding:20px;}
.card{background:#111826;padding:20px;border-radius:20px;max-width:600px;width:100%;}
input,textarea,button{width:100%;padding:12px;margin-top:8px;border-radius:12px;border:none;}
button{background:#22c55e;color:#05120a;font-weight:700;cursor:pointer;}
</style>
</head>
<body>
<div class="card">
<h2>영상 도네이션</h2>
<label>닉네임</label>
<input id="name" placeholder="닉네임">
<label>영상 URL</label>
<input id="url" placeholder="https://youtu.be/...">
<label>메시지 (선택)</label>
<textarea id="msg" placeholder="응원 메시지"></textarea>
<button id="send">영상 보내기</button>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBiDe-6X-nKUfAgwWWWriI2U9wpNpQ9hk8",
  authDomain: "toiden.firebaseapp.com",
  databaseURL: "https://toiden-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "toiden",
  storageBucket: "toiden.firebasestorage.app",
  messagingSenderId: "696461176231",
  appId: "1:696461176231:web:2120f172e52eaba91a1a82"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database().ref('rooms/tobrothertoiden/queue');
function classifyURL(url){
  try{ const u=new URL(url); if(/youtu\.be|youtube\.com/.test(u.host)) return {type:'youtube', ytid: u.searchParams.get('v') || u.pathname.slice(1)}; if(/clips\.twitch\.tv/.test(u.host)) return {type:'twitch'}; if(/\.(mp4|webm)/.test(u.pathname)) return {type:'html5'}; return {type:'unknown'} }catch(e){ return {type:'invalid'} } }
document.getElementById('send').addEventListener('click',()=>{
  const name=(document.getElementById('name').value||'익명').slice(0,40);
  const url=document.getElementById('url').value.trim();
  const msg=document.getElementById('msg').value.slice(0,140);
  const c=classifyURL(url);
  if(c.type==='invalid'||c.type==='unknown'){alert('지원되지 않는 URL입니다.'); return;}
  db.push({name,url,type:c.type,ytid:c.ytid||null,msg,ts:Date.now()});
  alert('영상이 전송되었습니다!');
  document.getElementById('url').value=''; document.getElementById('msg').value='';
});
</script>
</div>
</body>
</html>
