<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Overlay</title>
<style>
body{ margin:0; background:transparent; color:white; overflow:hidden; font-family:sans-serif; }
#overlay { position:relative; width:100%; height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; }
#message{ font-size:3em; background:rgba(0,0,0,0.6); padding:12px 24px; border-radius:12px; opacity:1; transition:opacity 0.5s; }
#video-player{ max-width:90%; max-height:80%; display:none; border:3px solid white; border-radius:12px; }
</style>
</head>
<body>
<div id="overlay">
  <div id="message"></div>
  <iframe id="video-player" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBiDe-6X-nKUfAgwWWWriI2U9wpNpQ9hk8",
  authDomain: "toiden.firebaseapp.com",
  databaseURL: "https://toiden-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "toiden",
  storageBucket: "toiden.firebasestorage.app",
  messagingSenderId: "696461176231",
  appId: "1:696461176231:web:2120f172e52eaba91a1a82"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const ROOM = "tobrothertoiden";
const overlayRef = db.ref(`rooms/${ROOM}/overlay`);
const messageDiv = document.getElementById("message");
const videoFrame = document.getElementById("video-player");

overlayRef.on("value", snap => {
  const item = snap.val();
  if(!item) return;

  // 1️⃣ 메시지 먼저
  messageDiv.textContent = item.msg || '';
  messageDiv.style.opacity = "1";
  videoFrame.style.display = "none";
  videoFrame.src = "";

  // 2️⃣ 5초 후 영상 재생
  setTimeout(()=>{
    messageDiv.style.opacity = "0";
    setTimeout(()=>{
      messageDiv.style.display = "none";
      videoFrame.style.display = "block";

      if(item.type==="youtube" && item.ytid){
        // 유튜브 자동 재생, 음소거 해제
        videoFrame.src = `https://www.youtube.com/embed/${item.ytid}?autoplay=1&mute=0&enablejsapi=1`;
      } else {
        // html5 영상
        videoFrame.src = item.url;
      }
    },500);
  },5000);
});
</script>
</body>
</html>
