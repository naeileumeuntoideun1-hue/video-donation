<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>Admin</title>
</head>
<body>
<h2>관리자 페이지</h2>
<div id="queue-list"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const ROOM = 'tobrothertoiden';
const firebaseConfig = {
  apiKey: "AIzaSyBiDe-6X-nKUfAgwWWWriI2U9wpNpQ9hk8",
  authDomain: "toiden.firebaseapp.com",
  databaseURL: "https://toiden-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "toiden",
  storageBucket: "toiden.firebasestorage.app",
  messagingSenderId: "696461176231",
  appId: "1:696461176231:web:2120f172e52eaba91a1a82"
};
firebase.initializeApp(firebaseConfig);

const dbRef = firebase.database().ref(`rooms/${ROOM}/queue`);
const $q = document.getElementById('queue-list');
let queue = [];

function renderQueue(){
  $q.innerHTML='';
  queue.forEach((item, idx)=>{
    const div = document.createElement('div');
    div.innerHTML=`${item.name} - ${item.url} <button data-idx="${idx}">삭제</button>`;
    $q.appendChild(div);
  });
}

$q.addEventListener('click', async e=>{
  const btn = e.target.closest('button');
  if(!btn) return;
  const idx = +btn.dataset.idx;
  const item = queue[idx];
  if(!item) return;
  if(confirm(`"${item.name}"님의 영상을 삭제하시겠습니까?`)){
    await dbRef.child(item.key).remove();
  }
});

dbRef.on('value', snap=>{
  const val = snap.val()||{};
  queue = Object.entries(val).map(([key,item])=>({...item,key}));
  renderQueue();
});
</script>
</body>
</html>
