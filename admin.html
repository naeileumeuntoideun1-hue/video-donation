<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>영상 도네이션 • 관리자</title>
<style>
body { font-family:sans-serif; background:#0b0f14; color:#e6edf3; padding:20px; }
table{ width:100%; border-collapse:collapse; }
th, td{ padding:8px; border:1px solid #555; }
button { padding:4px 8px; border:none; border-radius:6px; cursor:pointer; }
.deleteBtn { background:#ef4444; color:white; }
</style>
</head>
<body>
<h2>관리자 페이지</h2>
<table>
<thead>
<tr><th>닉네임</th><th>메시지</th><th>영상 URL</th><th>타입</th><th>삭제</th></tr>
</thead>
<tbody id="queueBody"></tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBiDe-6X-nKUfAgwWWWriI2U9wpNpQ9hk8",
  authDomain: "toiden.firebaseapp.com",
  databaseURL: "https://toiden-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "toiden",
  storageBucket: "toiden.appspot.com",
  messagingSenderId: "696461176231",
  appId: "1:696461176231:web:2120f172e52eaba91a1a82"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const ROOM = "tobrothertoiden";
const tbody = document.getElementById('queueBody');

function deleteVideo(key){ set(ref(db, `rooms/${ROOM}/queue/${key}`), null); }

onValue(ref(db, `rooms/${ROOM}/queue`), snapshot=>{
  const list = snapshot.val() || {};
  tbody.innerHTML='';
  Object.entries(list).forEach(([key, item])=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${item.name}</td>
      <td>${item.msg||''}</td>
      <td><a href="${item.url}" target="_blank">${item.url}</a></td>
      <td>${item.type}</td>
      <td><button class="deleteBtn">삭제</button></td>
    `;
    tr.querySelector('.deleteBtn').addEventListener('click', ()=> deleteVideo(key));
    tbody.appendChild(tr);
  });
});
</script>
</body>
</html>
